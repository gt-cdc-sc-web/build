(function(){"use strict";var data={male:[{years:4,height:1.2,age:-7.3,boneAge:0,constant:82},{years:5,height:1.2,age:-7.3,boneAge:0,constant:82},{years:6,height:1.2,age:-7.3,boneAge:0,constant:82},{years:7,height:1.2,age:-7.3,boneAge:0,constant:82},{years:8,height:1.22,age:-7.2,boneAge:-.4,constant:82},{years:8.5,height:1.23,age:-7,boneAge:-.7,constant:82},{years:9,height:1.22,age:-6.8,boneAge:-.8,constant:82},{years:9.5,height:1.21,age:-6.5,boneAge:-.8,constant:82},{years:10,height:1.2,age:-6.2,boneAge:-1,constant:83},{years:10.5,height:1.19,age:-5.9,boneAge:-1.2,constant:84},{years:11,height:1.16,age:-5.5,boneAge:-1.6,constant:89},{years:11.5,height:1.13,age:-5.1,boneAge:-2,constant:94},{years:12,height:1.08,age:-4.2,boneAge:-2.6,constant:98},{years:12.5,height:1.03,age:-3.4,boneAge:-3.2,constant:108},{years:13,height:.98,age:-2.6,boneAge:-3.8,constant:108},{years:13.5,height:.94,age:-1.9,boneAge:-4.4,constant:113},{years:14,height:.9,age:-1.4,boneAge:-4.5,constant:114},{years:14.5,height:.87,age:-1,boneAge:-4.6,constant:114},{years:15,height:.84,age:-.8,boneAge:-3.8,constant:104},{years:15.5,height:.82,age:-.6,boneAge:-3.1,constant:94},{years:16,height:.88,age:-.4,boneAge:-2.4,constant:71},{years:16.5,height:.94,age:-.3,boneAge:-1.8,constant:48},{years:17,height:.96,age:-.2,boneAge:-1.2,constant:34},{years:17.5,height:.98,age:-.1,boneAge:-.7,constant:19}],female:[{years:4,height:.95,age:-6.5,boneAge:0,constant:93},{years:5,height:.95,age:-6.5,boneAge:0,constant:93},{years:6,height:.95,age:-6,boneAge:-.4,constant:93},{years:6.5,height:.95,age:-5.5,boneAge:-.8,constant:93},{years:7,height:.94,age:-5.1,boneAge:-1,constant:94},{years:7.5,height:.93,age:-4.7,boneAge:-1.1,constant:94},{years:8,height:.92,age:-4.4,boneAge:-1.5,constant:95},{years:8.5,height:.92,age:-4,boneAge:-1.9,constant:96},{years:9,height:.92,age:-3.8,boneAge:-2.3,constant:99},{years:9.5,height:.91,age:-3.6,boneAge:-2.7,constant:102},{years:10,height:.89,age:-3.2,boneAge:-3.2,constant:106},{years:10.5,height:.87,age:-2.7,boneAge:-3.6,constant:109},{years:11,height:.83,age:-2.6,boneAge:-3.6,constant:114},{years:11.5,height:.82,age:-2.5,boneAge:-3.6,constant:115},{years:12,height:.83,age:-2.4,boneAge:-3.4,constant:111},{years:12.5,height:.83,age:-2.3,boneAge:-3.3,constant:108},{years:13,height:.85,age:-2,boneAge:-3.1,constant:98},{years:13.5,height:.87,age:-1.8,boneAge:-3,constant:90},{years:14,height:.91,age:-1.6,boneAge:-2.8,constant:79},{years:14.5,height:.99,age:-1.4,boneAge:-2.5,constant:67},{years:11,height:.87,age:-2.3,boneAge:-3.3,constant:100},{years:11.5,height:.89,age:-1.9,boneAge:-3.3,constant:91},{years:12,height:.91,age:-1.4,boneAge:-3.2,constant:82},{years:12.5,height:.93,age:-1,boneAge:-2.7,constant:67},{years:13,height:.95,age:-.9,boneAge:-2.2,constant:55},{years:13.5,height:.96,age:-.9,boneAge:-1.8,constant:48},{years:14,height:.96,age:-.8,boneAge:-1.4,constant:40},{years:14.5,height:.97,age:-.8,boneAge:-1.3,constant:37},{years:15,height:.98,age:-.6,boneAge:-1.1,constant:30},{years:15.5,height:.99,age:-.4,boneAge:-.7,constant:20}]};function getBoneAgeEstimate(patient){var AG,BA,HV,SA,HA,tmp,cur,l,i,table,prevRow,nextRow,row,out,weight;function mean(a,b,weight){return b*weight+a*(1-weight)}patient=patient||GC.App.getPatient();if(!patient){return null}AG=patient.getCurrentAge();if(AG.getYears()<4){return null}BA=patient.getLastEnryHaving("boneAge");if(!BA){return null}tmp=patient.data.lengthAndStature;l=tmp.length;if(!l){return null}for(i=l-1;i>=0;i--){cur=tmp[i];if(!HV){HV=cur}else{if(Math.abs(HV.agemos-BA.agemos)>Math.abs(cur.agemos-BA.agemos)){HV=cur}}}if(Math.abs(HV.agemos-BA.agemos)>1){return null}table=data[patient.gender];SA=BA.agemos/12;for(i=0;i<table.length;i++){row=table[i];if(row.years<=SA){if(!prevRow||prevRow.years<=row.years){prevRow=row}}if(row.years>=SA){if(!nextRow||nextRow.years>=row.years){nextRow=row}}}weight=(SA-prevRow.years)/(nextRow.years-prevRow.years);var height=mean(prevRow.height,nextRow.height,weight),age=mean(prevRow.age,nextRow.age,weight),boneAge=mean(prevRow.boneAge,nextRow.boneAge,weight),constant=mean(prevRow.constant,nextRow.constant,weight);out=height*HV.value+age*SA+boneAge*BA.boneAge/12+constant;return out}GC.getBoneAgeEstimate=getBoneAgeEstimate})();